<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>å°å©‰è¹ğŸ¬ä¸“å±æŠ½å¥–</title>
    <style>
      * {
        margin: 0;
        padding: 0;
      }
      html,
      body {
        height: 100%;
      }
      ul {
        list-style: none;
      }

      @keyframes white-to-yellow {
        0% {
          background: #fff;
        }
        100% {
          background: #d7a945;
        }
      }
      @keyframes heartbeat {
        0% {
          transform: scale(1);
        }
        25% {
          transform: scale(0.8);
        }
        50% {
          transform: scale(1.2);
        }
        75% {
          transform: scale(0.9);
        }
        100% {
          transform: scale(1);
        }
      }

      .turntable-wrap {
        position: relative;
        overflow: hidden;
        margin: 50px;
        width: 340px;
        height: 340px;
        border: 7px solid #b2a98d;
        border-radius: 50%;
        box-shadow: 0 0 20px #b2a98d;
      }
      .turntable-wrap .light {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #e0ddd1;
        animation: rotate 5s linear infinite;
      }
      .turntable-wrap .light span {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        margin: 0 auto;
        width: 10px;
        height: 100%;
        border-radius: 50%;
        transform-origin: center center;
      }
      .turntable-wrap .light span:before {
        content: "";
        position: absolute;
        top: 5px;
        left: 0;
        right: 0;
        margin: 0 auto;
        width: 10px;
        height: 10px;
        border-radius: 50%;
      }
      .turntable-wrap .light span:nth-of-type(even):before {
        background: #fff;
        animation: white-to-yellow 1s linear infinite;
      }
      .turntable-wrap .light span:nth-of-type(odd):before {
        background: #d7a945;
        animation: white-to-yellow 1s linear reverse infinite;
      }

      .turntable-wrap .turntable {
        position: absolute;
        margin: 20px;
        width: 300px;
        height: 300px;
        border-radius: 50%;
        background: #fff;
      }
      .turntable-wrap .turntable .bg {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #fff;
        border: 1px solid #dfd8be;
        border-radius: 50%;
        transform: rotate(90deg);
      }
      .turntable-wrap .turntable .bg li {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        margin: 0 auto;
        width: 1px;
        height: 100%;
        background: #dfd8be;
        transform-origin: center center;
      }

      .turntable-wrap .turntable .gift {
        position: relative;
        width: 100%;
        height: 100%;
        transform: rotate(45deg);
      }
      .turntable-wrap .turntable .gift li {
        position: absolute;
        top: 5%;
        left: 5%;
        width: 45%;
        height: 45%;
        transform-origin: right bottom;
      }
      .turntable-wrap .turntable .gift li span {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        display: block;
        width: 70px;
        height: 70px;
        margin: auto;
        transform: rotate(-45deg);
        text-align: center;
        line-height: 80px;
        border-radius: 5px;
        color: #fff;
        font-size: 24px;
      }
      .turntable-wrap .turntable .gift li:not(.no-gift) span:before {
        content: "";
        position: absolute;
        top: 15px;
        left: 0;
        width: 50px;
        height: 1px;
        background: #fff;
      }
      .turntable-wrap .turntable .gift li.no-gift span {
        line-height: 27px;
        color: #bfa74f;
        font-size: 12px;
      }

      .turntable-wrap .pointer {
        box-sizing: border-box;
        position: absolute;
        top: 50%;
        left: 0;
        right: 0;
        margin: -23px auto;
        width: 46px;
        height: 46px;
        border-radius: 50%;
        background: #fff;
        border: 5px solid #fff;
        box-shadow: 0 0 0 5px #b9a046;
        text-align: center;
        line-height: 16px;
        color: #b9a046;
        font-size: 14px;
        font-weight: 700;
        cursor: pointer;
      }
      .turntable-wrap .pointer:before {
        content: "";
        position: absolute;
        top: -58px;
        left: 0;
        right: 0;
        margin: 0 auto;
        width: 0;
        border-style: solid;
        border-color: transparent transparent #b9a046 transparent;
        border-width: 25px 10px 25px 10px;
      }
    </style>
  </head>
  <body>
    <div class="turntable-wrap">
      <div class="light" id="turntable_light"></div>
      <div class="turntable" id="turntable">
        <ul class="bg" id="turntable_bg"></ul>
        <ul class="gift" id="turntable_gift"></ul>
      </div>
      <div class="pointer disabled" id="turntable_pointer">ç‚¹å‡»æŠ½å¥–</div>
    </div>

    <script>
      // å•ä¾‹æ¨¡å¼ï¼Œè½¬ç›˜å”¯ä¸€ï¼Œç”¨å¯¹è±¡å­—é¢é‡æ–¹å¼è¡¨ç¤º
      let turntable = {
        itemNum: 5, // è½¬ç›˜å¹³å‡åˆ†å‡ å—

        lightNum: 18, // è½¬ç›˜ä¸Šçš„ç¯
        light: null, // è½¬ç›˜æ—‹è½¬ç¯å®¹å™¨

        turntable: null, // è½¬ç›˜

        bg: null, // è½¬ç›˜èƒŒæ™¯

        gift: null, // è½¬ç›˜ä¸Šçš„ä¸­å¥–ç»“æœå›¾

        pointer: null, // è½¬ç›˜æŒ‡é’ˆ

        lottery: [], // ä¸­å¥–æ•°æ®

        typeMap: {
          1: "é¸¡è…¿",
          2: "é¸¡ç¿…",
          3: "ç³–æ°´",
          4: "å¥¶èŒ¶",
          5: "å¾…å®šå°åƒ",
          // 6: "æ³¡æ¸©æ³‰",
          // 7: "æ¸¸æ³³",
          // 8: "çœ‹æ—¥å‡ºæ—¥è½",
          //  9: "æ”¾é£ç­",
          //  10: "å»å¯ºåº™ç¥ˆç¦",
        },
        typeClassMap: {
          1: "no-gift",
          2: "no-gift",
          3: "no-gift",
          4: "no-gift",
          5: "no-gift",
          //  6: "no-gift",
          //  7: "no-gift",
          //  8: "no-gift",
          //  9: "no-gift",
          //  10: "no-gift",
        },

        isGoing: false, // æ¸¸æˆæ˜¯å¦å¼€å§‹

        init() {
          if (!this.lottery.length) {
            this.pointer.style.display = "none";
            throw new Error("è¯·è®¾ç½®ä¸­å¥–ç»“æœæ•°æ®");
          }

          // åˆå§‹åŒ–ç¯
          let lightFragment = document.createDocumentFragment();
          for (let i = 0; i < this.lightNum; i++) {
            let lightItem = document.createElement("span");
            let deg = (360 / this.lightNum) * i;
            lightItem.style.transform = `rotate(${deg}deg)`;
            lightFragment.appendChild(lightItem);
          }
          this.light.appendChild(lightFragment);

          // åˆå§‹åŒ–è½¬ç›˜èƒŒæ™¯ã€è½¬ç›˜ä¸Šçš„ä¸­å¥–å›¾ï¼ˆç”¨ä¸åŒèƒŒæ™¯è‰²ä»£æ›¿ï¼‰
          let bgFragment = document.createDocumentFragment();
          let bgItemWidth = this.bg.offsetWidth / this.num;
          let giftFragment = document.createDocumentFragment();
          for (let i = 0; i < this.itemNum; i++) {
            let bgItem = document.createElement("li");
            let deg = (360 / this.itemNum) * i;
            bgItem.style.transform = `rotate(${deg}deg)`;
            bgFragment.appendChild(bgItem);

            let giftItem = document.createElement("li");
            giftItem.style.transform = `rotate(${deg}deg)`;
            giftItem.className = this.typeClassMap[this.lottery[i].type];
            let span = document.createElement("span");
            span.innerHTML = this.typeMap[this.lottery[i].type];
            giftItem.appendChild(span);
            giftFragment.appendChild(giftItem);
          }
          this.bg.appendChild(bgFragment);
          this.gift.appendChild(giftFragment);

          // ç»™ç‚¹å‡»æŠ½å¥–æŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶
          this.pointer.onclick = this.gameStart.bind(this);
        },

        gameStart() {
          if (this.isGoing) {
            return;
          }
          this.isGoing = true;

          // 1. éšæœºä¸­å¥–ç»“æœ
          // ä»1-100ä¹‹é—´å¾—åˆ°ä¸€ä¸ªéšæœºæ•°ï¼Œçœ‹è¿™ä¸ªéšæœºæ•°åœ¨ä¸­å¥–è®¾ç½®çš„èŒƒå›´ï¼Œå¾—åˆ°æœ€ç»ˆä¸­å¥–çš„é¡¹
          let randomRate = ~~(Math.random() * 100); // ~~ == Math.floor()
          // è®¾ç½®ä¸­å¥–æ•°æ®çš„æ¦‚ç‡èŒƒå›´
          let num = 0;
          this.lottery.forEach((item) => {
            item.min = num;
            num += item.rate;
            item.max = num;
          });
          // æ ¹æ®éšæœºæ•°ï¼Œå¾—åˆ°ä¸­å¥–ç»“æœ
          let res = this.lottery.filter((item) => {
            return randomRate >= item.min && randomRate < item.max;
          })[0];
          // è¿™å„¿å¯ä»¥æ ¹æ®å®é™…æƒ…å†µï¼Œå¯é‡ç½®ä¸­å¥–ç»“æœ

          // 2. è®¡ç®—æ—‹è½¬è§’åº¦, éœ€è¦å¤šè½¬5åœˆï¼Œè¾¾è½¬1åœˆç”¨æ—¶1s, åˆ°æ—‹è½¬çš„æ•ˆæœ
          let rotateItemDeg = (res.location - 1) * (360 / this.lottery.length); // æ¯ä¸ªitemæ—‹è½¬è§’åº¦, ç¬¬ä¸€ä¸ªä¸ç”¨æ—‹è½¬
          let rotate = rotateItemDeg + 5 * 360;
          let rotateSpeed = ((rotateItemDeg / 360) * 1 + 5).toFixed(2);
          // é‡ç½®è½¬ç›˜æ ·å¼
          this.turntable.removeAttribute("style");
          // ä¿è¯ä¸‹ä¸€æ¬¡æ—‹è½¬åŠ¨ç”»ç”Ÿæ•ˆ
          setTimeout(() => {
            this.turntable.style.transform = `rotate(${rotate}deg)`;
            this.turntable.style.transition = `transform ${rotateSpeed}s ease-out`;
          }, 10);

          // 3. åŠ¨ç”»ç»“æŸï¼Œæ˜¾ç¤ºä¸­å¥–ç»“æœï¼Œä¸­å¥–ç»“æœå¦‚ä½•æ˜¾ç¤ºï¼Œè§†å®é™…æƒ…å†µè€Œå®š
          setTimeout(() => {
            this.isGoing = false;
            console.log("ä¸­å¥–ç»“æœï¼š", randomRate, res, this.typeMap[res.type]);
          }, rotateSpeed * 1000);
        },
      };

      let lottery = [
        { location: 1, type: 1, rate: 20 },
        { location: 2, type: 2, rate: 20 },
        { location: 3, type: 3, rate: 20 },
        { location: 4, type: 4, rate: 20 },
        { location: 5, type: 5, rate: 20 },
        // { location: 6, type: 6, rate: 10 },
        //  { location: 7, type: 7, rate: 10 },
        // { location: 8, type: 8, rate: 10 },
        // { location: 9, type: 9, rate: 10 },
        // { location: 10, type: 10, rate: 10 },
      ];

      turntable.turntable = document.querySelector("#turntable");
      turntable.light = document.querySelector("#turntable_light");
      turntable.bg = document.querySelector("#turntable_bg");
      turntable.gift = document.querySelector("#turntable_gift");
      turntable.pointer = document.querySelector("#turntable_pointer");
      turntable.lottery = lottery;
      turntable.init();
    </script>
  </body>
</html>
